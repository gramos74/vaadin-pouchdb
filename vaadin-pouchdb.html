<!-- PouchDB script -->
<script src="../pouchdb/dist/pouchdb.js"></script>
<link rel="import" href="../polymer/polymer.html">

<dom-module id="vaadin-pouchdb">
</dom-module>
<script>
  Polymer({
    is: 'vaadin-pouchdb',
    properties: {
      dbname: {
        type: String,
        value: 'default-db'
      },
      remote: {
        type: String,
        value: null
      }
    },
    _db: null,

    create: function() {
      console.log('new vaadin-pouchdb dbname=' + this.dbname);
      this._db = new PouchDB(this.dbname);
    },

    /**
     * Info
     *
     * @method info
     * @param {Object} info example: since:0, include_docs: true, limit: pagesize, live: true
     * @param {Function} fnc
     * @param {Function} err
     */
    info: function(info, fnc, err) {
       return this._db.changes({since: info.update_seq, onError: err, onChange: fnc, continuous: true});
    },

    /**
     * Post
     *
     * @method post
     * @param {Object} obj
     * @param {Function} fnc
     * @param {Function} err
     */
    post: function(obj, fnc, err) {
      return this._db.post(obj, function(error, result) {
        if (!error) {
          if (fnc) fnc(result);
        } else {
          if (err) err(error)
        }
      });
    },

    /**
     * allDocs
     *
     * @method allDocs
     * @return {Promise} a promise
     */
    allDocs: function() {
      return this._db.allDocs({include_docs: true});
    },

    /**
     * Remove
     *
     * @method remove
     * @param {Object} obj
     * @return {Promise} a promise
     */
    remove: function(obj) {
      return this._db.remove(obj);
    },

    /**
     * Put
     *
     * @method put
     * @param {Object} obj
     * @return {Promise} a promise
     */
    put: function(obj) {
      return this._db.put(obj);
    },

    sync: function(syncError) {
      var remote = new PouchDB(this.remote, {headers: {'Cookie': 'Todo'}});
      var pushRep = this._db.replicate.to(remote, {
        continuous: true,
        complete: syncError
      });
      var pullRep = this._db.replicate.from(remote, {
        continuous: true,
        complete: syncError
      });
    }

  });
</script>

<script>
Polymer.Vaadin = Polymer.Vaadin || {};

/**
 * @polymerBehavior Promise
 */
Polymer.Vaadin.Promise = {
  /**
   * @method exec
   * @param {Function} func
   */
  then: function(func){}
};
</script>
