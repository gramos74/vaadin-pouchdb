<!-- PouchDB script -->
<script src="../pouchdb/dist/pouchdb.js"></script>
<link rel="import" href="../polymer/polymer.html">

<dom-module id="pouch-db">
</dom-module>
<script>
  Polymer({
    is: 'pouch-db',
    properties: {
      dbname: {
        type: String,
        value: 'default-db'
      },
      remote: {
        type: String,
        value: null
      }
    },
    _db: null,

    attached: function() {
      console.log('new Pouch ' + this.dbname);
      this._db = new PouchDB(this.dbname);
    },
    
    /**
     * Info
     *
     * @method info
     * @param {Object} info example: since:0, include_docs: true, limit: pagesize, live: true
     * @param {Function} fnc
     * @param {Function} err
     */
    info: function(info, fnc, err) {
       this._db.changes({since: info.update_seq, onError: err, onChange: fnc, continuous: true});
    },
    
    /**
     * Post
     *
     * @method post
     * @param {Object} obj
     * @param {Function} fnc
     * @param {Function} err
     */
    post: function(obj, fnc, err) {
      this._db.post(obj, function(error, result) {
        if (!error) {
          if (fnc) fnc(result);
        } else {
          if (err) err(error)
          else console.log(error)
        }
      });      
    },
     
    /**
     * Post
     *
     * @method post
     * @param {Function} fnc
     * @param {Function} err
     */
    allDocs: function(fnc, err) {
      this._db.allDocs({include_docs: true}, function(error, result) {
        if (!error) {
          if (fnc) fnc(result);
        } else {
          if (err) err(error)
          else console.log(error)
        }
      });      
    },

    /**
     * Remove
     *
     * @method remove
     * @param {Object} obj
     */
    remove: function(obj) {
      this._db.remove(obj);      
    },    
     
    /**
     * Put
     *
     * @method put
     * @param {Object} obj
     */
    put: function(obj) {
      this._db.put(obj);      
    },
    
    sync: function(syncError) {
      var remote = new PouchDB(this.remote, {headers: {'Cookie': 'Todo'}});
      var pushRep = this._db.replicate.to(remote, {
        continuous: true,
        complete: syncError
      });
      var pullRep = this._db.replicate.from(remote, {
        continuous: true,
        complete: syncError
      });      
    }
    
  });
</script>
